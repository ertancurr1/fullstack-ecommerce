import { NavLink } from "react-router-dom";
import { useQuery } from "@apollo/client";
import { GET_CATEGORIES } from "../graphql/queries";
import { useCart } from "../context/CartContext";
import type { Category } from "../types";
import "./Header.scss";

function Header() {
  const { data } = useQuery<{ categories: Category[] }>(GET_CATEGORIES);
  const { totalItems, toggleCart } = useCart();

  return (
    <header className="header">
      <nav className="header__nav">
        {data?.categories.map((category: Category) => (
          <NavLink
            key={category.name}
            to={`/${category.name}`}
            className={({ isActive }) =>
              `header__nav-link ${isActive ? "active" : ""}`
            }
          >
            {({ isActive }) => (
              <span
                data-testid={
                  isActive ? "active-category-link" : "category-link"
                }
              >
                {category.name.toUpperCase()}
              </span>
            )}
          </NavLink>
        ))}
      </nav>

      <div className="header__logo">
        <svg
          width="64"
          height="64"
          viewBox="0 0 40 40"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fillRule="nonzero"
            fill="#5ECE7B"
            d="M10.332 6.609h.11c.12 0 .238 0 .359 0h.261c.238 0 .477 0 .715 0 .258 0 .512 0 .77 0 .503 0 1.007 0 1.511 0 .41 0 .817 0 1.227 0h.176c.12 0 .238 0 .355 0 .793-.004 1.586-.004 2.383-.004h.094c.156 0 .312 0 .472 0h.094c.062 0 .125 0 .191 0 .98.004 1.965 0 2.95 0 1.105 0 2.21 0 3.316 0 .586 0 1.168 0 1.754 0 .5 0 .996 0 1.496 0 .254 0 .508 0 .762 0 .234 0 .465 0 .699 0h.25c.117 0 .23 0 .344 0h.101c.242 0 .375.066.559.215.074.094.09.164.113.277l.02.106c.023.214.02.429.015.643l.102-.008c.156-.004.312-.008.465-.012l.164-.012c.27-.004.453 0 .664.18.2.2.25.355.262.636l.012.176.004.094c.008.164.016.328.027.496 0 .031.004.066.004.101.02.317.05.63.086.946.059.559.101 1.121.14 1.68.04.628.09 1.257.153 1.882.054.586.098 1.172.136 1.758.024.332.047.66.094.992.07.547.102 1.102.136 1.653.062.922.062.922.16 1.84.055.484.079.972.114 1.46.05.727.101 1.454.171 2.18.024.27.043.54.063.809.023.273.05.543.082.812.05.457.086.914.117 1.371l.023.364.016.222c.011.14.023.281.046.418.035.207.047.414.066.625l.008.14c.016.153.028.305.04.461l.012.157c.054.699.105 1.398.144 2.101l.008.16.008.133c.012.136.031.27.055.402.027.242.039.48.046.723l.008.148c.004.164.008.328.012.492l.008.16c.004.293-.016.477-.223.692-.14.097-.293.101-.46.101h-.126c-.043 0-.086 0-.133 0h-.144c-.16.004-.325 0-.485 0-.117.004-.23.004-.348.004-.285 0-.574 0-.859 0-.344 0-.687 0-1.031 0-.829 0-1.657 0-2.489 0-.39 0-.78 0-1.175 0-1.34 0-2.684.004-4.028.004h-.25c-.086 0-.172 0-.254 0-.168 0-.34 0-.508 0h-.129c-1.363 0-2.726 0-4.09 0-1.437 0-2.878.004-4.32.004h-.473c-.058 0-.058 0-.117 0-.629 0-1.254 0-1.883 0-.629 0-1.258 0-1.89 0-.372 0-.747 0-1.122 0-.28 0-.558 0-.835 0h-.34c-.156 0-.309 0-.461 0h-.137c-.238 0-.402-.02-.61-.152-.109-.117-.136-.153-.136-.317h-.09c.028-.668.07-1.328.125-1.992.012-.156.024-.312.035-.468l.024-.301.011-.141c.016-.188.032-.379.055-.567.02-.133.032-.266.036-.399l.004-.125c.004-.086.008-.168.012-.254l.004-.121v-.11c.008-.109.008-.109.031-.214.024-.114.036-.223.043-.336l.008-.13.012-.136.008-.144c.008-.105.016-.211.024-.316.02-.278.039-.555.058-.832l.016-.172c.039-.547.086-1.094.13-1.644.066-.797.124-1.598.179-2.399.031-.508.074-1.016.125-1.524.027-.27.05-.543.078-.813l.008-.093c.062-.696.106-1.391.153-2.082l.008-.129c.004-.082.012-.16.016-.234.004-.036.008-.071.012-.11.003-.027.003-.059.007-.09.008-.078.02-.152.032-.23.023-.137.035-.266.043-.407l.008-.152.011-.168c.008-.117.016-.234.02-.352.016-.183.028-.367.044-.55.035-.602.074-1.203.152-1.801.027-.223.035-.445.043-.672l.012-.238v-.106c.008-.093.008-.093.031-.175.035-.145.04-.286.051-.434l.012-.211.012-.118c.016-.21.032-.422.047-.633.02-.297.04-.59.063-.883.02-.328.043-.656.07-.984.012-.164.024-.328.036-.492.011-.188.023-.371.039-.559l.012-.172c.027-.363.078-.547.344-.801.246-.113.476-.094.742-.086l.16.004c.133.004.262.008.39.011v-.094l.001-.12v-.122c.004-.312.012-.55.227-.8.19-.102.371-.102.582-.102z"
          />
          <path
            fillRule="nonzero"
            fill="#55C078"
            d="M10.332 6.609h.11c.12 0 .238 0 .359 0h.261c.238 0 .477 0 .715 0 .258 0 .512 0 .77 0 .503 0 1.007 0 1.511 0 .41 0 .817 0 1.227 0h.176c.12 0 .238 0 .355 0 .793-.004 1.586-.004 2.383-.004h.094c.156 0 .312 0 .472 0h.09c.063 0 .126 0 .192 0 .98.004 1.965 0 2.95 0 1.105 0 2.21 0 3.316 0 .586 0 1.168 0 1.754 0 .5 0 .996 0 1.496 0 .254 0 .508 0 .762 0 .234 0 .465 0 .699 0h.25c.117 0 .23 0 .344 0h.101c.25 0 .395.066.57.242.024.11.04.219.052.328l.023.176c.02.176.02.176.02.496H9.57c0-.863 0-.863.18-1.137.183-.109.375-.101.582-.101z"
          />
          <path
            fillRule="nonzero"
            fill="#FBFDFB"
            d="M13.867 18.031c.149.028.223.098.328.2.031.12.031.12.035.261l.008.156c.004.082.004.082.004.164.023.43.058.848.133 1.27l.02.128c.042.235.109.434.21.653l.036.16c.191.793.633 1.61 1.14 2.242l.098.125c.825 1.043 2.012 1.91 3.364 2.082.25.024.5.024.754.024l.137.004c.457 0 .879-.078 1.312-.223l.106-.035c.699-.246 1.32-.617 1.855-1.129.086-.074.086-.074.18-.074l.043-.137h.09l.039-.082c.054-.106.117-.18.199-.27.164-.183.305-.375.441-.582l.07-.105c.309-.477.575-.961.75-1.5l.032-.102c.254-.734.457-1.465.473-2.242l.004-.137c.004-.09.004-.175.004-.265.004-.207.008-.309.137-.481.16-.113.246-.117.437-.086.125.082.207.137.274.274.047.601-.051 1.183-.16 1.777-.02.106-.036.215-.055.32-.098.555-.27 1.11-.512 1.618-.031.066-.059.133-.086.196-.316.75-.781 1.43-1.32 2.031l-.074.082c-.746.817-1.688 1.422-2.739 1.778l-.117.039c-1.176.378-2.562.257-3.691-.223-.11-.055-.211-.117-.317-.18l-.16-.07c-1.555-.668-2.707-2.34-3.328-3.856-.207-.523-.348-1.058-.457-1.609l-.024-.11c-.09-.437-.129-.866-.133-1.312v-.133c.004-.383.051-.617.461-.64z"
          />
          <path
            fillRule="nonzero"
            fill="#FBFCFB"
            d="M26.305 15.375c.11.074.11.074.215.176l.12.113c.04.04.079.079.118.117.078.074.152.145.226.215.188.184.372.364.559.544.11.11.219.218.332.328.129.125.258.25.387.379l.125.117c.3.3.3.3.304.55-.008.125-.027.183-.094.297-.175.101-.324.113-.523.066-.172-.113-.305-.258-.446-.406l-.124-.125c-.106-.11-.215-.219-.32-.332-.11-.11-.22-.223-.329-.336-.215-.219-.43-.437-.64-.66-.149.066-.25.148-.364.261l-.105.11-.114.113-.117.117c-.125.125-.25.25-.371.375-.125.125-.25.25-.375.375-.078.078-.156.156-.23.234l-.106.11c-.031.03-.062.061-.094.097-.109.101-.164.117-.316.136-.168-.02-.168-.02-.301-.14-.14-.231-.14-.231-.094-.426.227-.305.516-.567.782-.832l.132-.133c.094-.09.184-.183.278-.273.117-.117.234-.235.351-.352.09-.094.18-.184.27-.274.066-.066.129-.129.195-.195l.117-.117.106-.102c.144-.136.25-.144.445-.125z"
          />
          <path
            fillRule="nonzero"
            fill="#DFF5E5"
            d="M26.305 18.05v.048l-.149.035c-.187.055-.187.055-.304.192-.023.12-.035.238-.047.363h-.043c-.023-.219-.031-.363.094-.547.16-.11.258-.11.449-.09z"
          />
        </svg>
      </div>

      <button
        className="header__cart-btn"
        onClick={toggleCart}
        data-testid="cart-btn"
      >
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
          <path
            d="M4 4H5.62L8.06 12.53C8.12 12.76 8.33 12.92 8.57 12.92H15.5C15.73 12.92 15.94 12.77 16 12.56L17.85 6.48C17.93 6.21 17.72 5.95 17.45 5.95H6.5"
            stroke="#1D1F22"
            strokeWidth="1.5"
            strokeLinecap="round"
            strokeLinejoin="round"
          />
          <circle cx="9" cy="16" r="1" fill="#1D1F22" />
          <circle cx="15" cy="16" r="1" fill="#1D1F22" />
        </svg>
        {totalItems > 0 && (
          <span className="header__cart-count">{totalItems}</span>
        )}
      </button>
    </header>
  );
}

export default Header;
